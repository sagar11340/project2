{% extends "layout.html" %}
{% block content %}
<div class="header-row">
  <h1 class="page-title">Pay â€” {{ student.first_name }} {{ student.last_name }}</h1>
  <div class="controls">
    <a href="{{ url_for('payments_list') }}" class="btn btn-secondary">Back</a>
  </div>
</div>


<div class="card" style="display:flex; gap:20px; align-items:flex-start;">
  <div style="flex:1 1 420px;">
    <form method="post" class="form">
      <div>
        <label>Student</label>
        <input type="text" class="form-control" value="{{ student.first_name }} {{ student.last_name }}" readonly>
      </div>
<div>
      <label class="form-label">Payment Date</label>
      <input type="date" name="admission_date" class="form-control large" value="{{ student.admission_date if student else '' }}">
    </div>
      
      <div>
      <label class="form-label">Course</label>
      <select name="course_id" class="form-select large">
        <option value="">Select course</option>
        {% for c in courses %}
          <option value="{{ c._id }}"
            {% if student and (student.course_id|string == c._id|string) %}selected{% endif %}>
            {{ c.name or c.title or ('Course ' ~ (c._id|string)) }}
          </option>
        {% endfor %}
      </select>
    </div>
      <div>
        <label>Amount</label>
        <input type="number" step="0.01" name="amount" class="form-control" required>
        +18% GST
      </div>

      <div>
        <label>Installment</label>
        <select name="installment" class="form-select">
          <option value="full">New</option>
          <option value="1st">Old</option>
          
        </select>
      </div>

      <div>
        <label>Payment Mode</label>
        <select name="payment_mode" class="form-select">
          <option>cash</option><option>online</option>
        </select>
      </div>

      <div>
  <label class="form-label">Faculty</label>

  <!-- dropdown (preferred) -->
  <select name="faculty_id" class="form-select large">
    <option value="">Select faculty</option>
    {% for f in faculties %}
      <option value="{{ f._id }}" {% if student and (student.faculty_id|string == f._id|string or student.faculty == f.name) %}selected{% endif %}>
        {{ f.name }}
      </option>
    {% endfor %}
  </select>

  <!-- optional fallback free-text (keeps compatibility with older entries) -->
  <input type="text" name="faculty" class="form-control mt-2" placeholder="Or type faculty name" value="{{ student.faculty if student else '' }}">
</div>


      <!-- <div>
        <label>Remarks</label>
        <input type="text" name="remarks" class="form-control">
      </div> -->

      <div style="margin-top:12px;">
        <button type="submit" class="btn btn-success"><i class="fa-solid fa-check"></i> Make Payment</button>
        <a class="btn btn-secondary" href="{{ url_for('payments_list') }}">Cancel</a>
      </div>
    </form>
  </div>

  <div style="width:360px;">
    <h4>Installment History</h4>
    {% if history %}
      <table class="table">
        <thead><tr><th>Date</th><th>Amount</th><th>GST</th><th>Receipt</th></tr></thead>
        <tbody>
          {% for h in history %}
          <tr>
            <td>{{ h.date.strftime('%Y-%m-%d') }}</td>
            <td>{{ h.amount }}</td>
            <td>{{ h.gst or 0 }}</td>
            <td><a href="{{ url_for('print_receipt', receipt_no=h.receipt_no) }}">{{ h.receipt_no }}</a></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="no-data">No payments found.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
