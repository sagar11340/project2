<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}INSTITUTE OF LANGUAGES AND CULTURE{% endblock %}</title>

  <meta name="description" content="RKM Delhi - Swami Ranganathananda Institute of Languages and Culture" />
  <meta name="theme-color" content="#ffffff" />

  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" />

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Swiper (home page only) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <style>
    :root { --brand: #0d6efd; }
    html, body { height: 100%; }
    body { font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: #fafafa; }

    .nav-spacer { height: 72px; }

    .active-link {
      background: rgba(0, 0, 0, 0.06) !important;
      border-radius: 6px;
      color: #000 !important;
    }

    .badge-notify { position: relative; }
    .badge-notify .count { position: absolute; top: -6px; right: -6px; font-size: 10px; display: inline-block; }

    #backToTop { position: fixed; right: 18px; bottom: 18px; display: none; z-index: 1050; }

    /* Swiper heights */
    .swiper { width: 100%; height: 280px; }
    @media (min-width: 768px) { .swiper { height: 380px; } }
    @media (min-width: 1200px) { .swiper { height: 480px; } }
    .swiper-slide img { width: 100%; height: 100%; object-fit: cover; }

    /* Navbar glass effect */
    .glass-nav { backdrop-filter: blur(6px) saturate(120%); background: rgba(255,255,255,0.75); }

    /* Footer */
    .site-footer { text-align: center; padding: 18px 12px; color: rgba(0,0,0,0.6); font-size: 0.95rem; }

    .main-container { padding-top: 20px; padding-bottom: 40px; }

    /* user-photo in navbar */
    .nav-user-photo { width:28px; height:28px; object-fit:cover; border-radius:6px; margin-right:8px; }
  </style>
</head>

<body class="{% if full_width %}p-0 m-0{% endif %}">

{# NAVBAR: show only if logged in, otherwise minimal header with login #}
{% if session.get('user_id') %}
<nav class="navbar navbar-expand-lg glass-nav fixed-top shadow-sm">
  <div class="container-fluid">

    <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
      <img src="{{ url_for('static', filename='logo.png') }}" onerror="this.style.display='none'" class="me-2" style="height:36px;border-radius:6px;">
      <span class="fw-bold">RKM</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">

        <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}"><i class="fa-solid fa-house me-1"></i> Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('students_list') }}"><i class="fa-solid fa-user-graduate me-1"></i> Students</a></li>
        <li class="nav-item d-lg-none"><a class="nav-link" href="{{ url_for('add_student') }}"><i class="fa-solid fa-user-plus me-1"></i> Add Student</a></li>

        <li class="nav-item"><a class="nav-link" href="{{ url_for('batches_list') }}"><i class="fa-solid fa-layer-group me-1"></i> Add Batch</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('courses_list') }}"><i class="fa-solid fa-book-open me-1"></i> Add Course</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('faculty_list') }}"><i class="fa-solid fa-chalkboard-user me-1"></i> Add Faculty</a></li>

        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('certificate_generator_page') }}">
            <i class="fa-solid fa-certificate me-1"></i> Certificates
          </a>
        </li>

        <li class="nav-item dropdown d-none d-lg-block">
          <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">More</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for('payments_list') }}">ğŸ’³ Fees Payment</a></li>
            <li><a class="dropdown-item" href="{{ url_for('payment_report') }}">ğŸ“„ Payment Report</a></li>
            <li><a class="dropdown-item" href="{{ url_for('student_report') }}">ğŸ‘¥ Student Report</a></li>
            <li><a class="dropdown-item" href="{{ url_for('genderwise_report') }}">âš¥ Genderwise Report</a></li>
            <li><a class="dropdown-item" href="{{ url_for('attendance') }}">ğŸ“ Attendance</a></li>
            <li><a class="dropdown-item" href="{{ url_for('attendance_view') }}">ğŸ‘ Check Attendance</a></li>
            <li><a class="dropdown-item" href="{{ url_for('attendance_history') }}">ğŸ“œ Attendance History</a></li>
            <li><a class="dropdown-item" href="{{ url_for('salary_generate') }}">ğŸ’¼ Generate Salary</a></li>
            <li><a class="dropdown-item" href="{{ url_for('salary_list') }}">ğŸ’¼ Salary Report</a></li>
            <li><a class="dropdown-item" href="{{ url_for('certificate_generator_page') }}">ğŸ“ Generate Certificate</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="{{ url_for('daybook') }}">ğŸ“˜ Daybook</a></li>
          </ul>
        </li>

      </ul>

      <div class="d-flex align-items-center">
        <form class="d-flex me-2" method="get" action="{{ url_for('students_list') }}">
          <input class="form-control form-control-sm" name="q" placeholder="Search..." value="{{ request.args.get('q','') }}" aria-label="Search students">
        </form>

        <a class="btn btn-sm btn-light badge-notify me-2" href="{{ url_for('notifications') }}" title="Notifications">
          <i class="fa-regular fa-bell"></i>
          <span id="notifBadge" class="badge bg-danger rounded-pill count">{{ session.get('notif_count', 0) }}</span>
        </a>

        <!-- <a class="btn btn-sm btn-outline-primary me-2 d-none d-lg-inline-flex" href="{{ url_for('certificate_generator_page') }}">
          <i class="fa-solid fa-certificate me-1"></i> Certificates
        </a> -->

        <div class="dropdown">
          <a class="btn btn-sm btn-outline-secondary dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown" aria-expanded="false">
            {# user photo: attempt custom path first, fall back to default images #}
            <img src="{{ url_for('static', filename='images/admin.png') }}" alt="user" class="nav-user-photo me-1"
                 onerror="this.onerror=null;this.src='{{ url_for('static', filename='images/user.png') }}'">
            <span class="d-none d-sm-inline">{{ session.get('admin_name', 'Admin') }}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{{ url_for('profile') }}">Profile</a></li>
            <li><a class="dropdown-item" href="{{ url_for('settings') }}">Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" onclick="logoutConfirm()">Logout</a></li>
          </ul>
        </div>

      </div>
    </div>

  </div>
</nav>

<div class="nav-spacer"></div>

{% else %}
<!-- Minimal header when not logged-in -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
      <img src="{{ url_for('static', filename='logo.png') }}" onerror="this.style.display='none'" class="me-2" style="height:36px;border-radius:6px;">
      <span class="fw-bold">RKM</span>
    </a>

    <div class="d-flex ms-auto">
      <a class="btn btn-sm btn-outline-primary me-2" href="{{ url_for('login') }}">Login</a>
    </div>
  </div>
</nav>

<div class="nav-spacer"></div>
{% endif %}

{# Home page hero (swiper) when on index endpoint #}
{% if request.endpoint == 'index' %}
<div class="swiper mySwiper">
  <div class="swiper-wrapper">
    <div class="swiper-slide"><img src="https://cdn.wallpapersafari.com/54/22/jJb0C5.jpg" alt=""></div>
    <div class="swiper-slide"><img src="https://cdn.wallpapersafari.com/14/42/AM4qWE.jpg" alt=""></div>
    <div class="swiper-slide"><img src="https://wallpapercave.com/wp/wp5224150.jpg" alt=""></div>
    <div class="swiper-slide"><img src="https://wallpaperaccess.com/full/8466193.jpg" alt=""></div>
  </div>
</div>
{% endif %}

<!-- Main container (full width fixed earlier) -->
<main class="container-fluid py-4 main-container">

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-info alert-dismissible fade show">
        {% for msg in messages %}<div>{{ msg }}</div>{% endfor %}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endif %}
  {% endwith %}

  {% block breadcrumb %}{% endblock %}
  {% block content %}{% endblock %}

</main>

<footer class="site-footer">
  RKM DELHI Â· SWAMI RANGANATHANANDA INSTITUTE Â© {{ current_year or 2025 }}
</footer>

<button id="backToTop" class="btn btn-primary btn-lg" aria-label="Back to top"><i class="fa-solid fa-arrow-up"></i></button>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

{% if request.endpoint == 'index' %}
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
  var swiper = new Swiper(".mySwiper", { loop: true, autoplay: { delay: 8000 } });
</script>
{% endif %}

<script>
  function logoutConfirm() {
    if (confirm("Are you sure you want to logout?")) {
      window.location.href = "{{ url_for('logout') }}";
    }
  }

  const back = document.getElementById('backToTop');
  window.addEventListener('scroll', () => back.style.display = window.scrollY > 300 ? 'block' : 'none');
  back.onclick = () => window.scrollTo({top: 0, behavior: 'smooth'});

  document.addEventListener('DOMContentLoaded', () => {
    // mark active nav-link by pathname (works even if query params differ)
    const curr = location.pathname.replace(/\/+$/, '') || '/';
    document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
      try {
        const linkPath = new URL(link.href).pathname.replace(/\/+$/, '') || '/';
        if (linkPath === curr) link.classList.add('active-link');
      } catch(e){
        // ignore invalid hrefs
      }
    });
  });
</script>

</body>
</html>
